<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETERNAL FORGE - Master Randomizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        const GEMINI_API_KEY = "";
        const TEXT_MODEL = 'gemini-2.5-flash-preview-09-2025';
        const IMAGE_MODEL = 'imagen-4.0-generate-001'; 

        let db, auth, userId = null;
        
        // Attached to window to avoid ReferenceErrors in inline event handlers
        window.skills = []; 
        window.currencies = []; 
        window.inventory = []; 

        window.initFirebase = async () => {
            if (Object.keys(firebaseConfig).length === 0) return;
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                if (initialAuthToken) await signInWithCustomToken(auth, initialAuthToken);
                else await signInAnonymously(auth);

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('userIdDisplay').textContent = `User ID: ${userId}`;
                        window.setupDataListener();
                    }
                });
            } catch (error) { console.error(error); }
        };

        function getCharacterDocRef() {
            if (!userId || !db) return null;
            return doc(db, 'artifacts', appId, 'public', 'data', 'characters', userId);
        }

        window.loadCharacter = (data) => {
            document.getElementById('playerName').value = data.playerName || '';
            document.getElementById('name').value = data.name || '';
            document.getElementById('race').value = data.race || '';
            document.getElementById('height').value = data.height || '';
            document.getElementById('weight').value = data.weight || '';
            
            const genreSelect = document.getElementById('generatorGenre');
            const customGenreDiv = document.getElementById('customGenreContainer');
            const genreList = ['Fantasy', 'Sci-Fi', 'Modern', 'Cyberpunk', 'Steampunk'];
            
            if (genreList.includes(data.genre)) {
                genreSelect.value = data.genre;
                customGenreDiv.classList.add('hidden');
            } else {
                genreSelect.value = 'Other';
                customGenreDiv.classList.remove('hidden');
                document.getElementById('customGenre').value = data.genre || '';
            }

            document.getElementById('backstoryOutput').value = data.backstory || '';

            if (data.stats) {
                document.getElementById('physicality').value = data.stats.physicality || 5;
                document.getElementById('agility').value = data.stats.agility || 5;
                document.getElementById('intuition').value = data.stats.intuition || 5;
                document.getElementById('charisma').value = data.stats.charisma || 5;
            }
            
            const imgElement = document.getElementById('characterImage');
            imgElement.src = data.imageUrl || "https://placehold.co/150x200/cccccc/333333?text=Character+Image";
            imgElement.dataset.url = data.imageUrl || '';

            window.skills = data.skills || [];
            window.currencies = data.currencies || [{ name: 'Gold Pieces', amount: 0 }];
            window.inventory = data.inventory || [];

            window.renderSkills();
            window.renderCurrencies();
            window.renderInventory();
            window.calculateMovement(); 
        };

        window.saveCharacter = async () => {
            const docRef = getCharacterDocRef();
            if (!docRef) return;
            
            const selectedGenre = document.getElementById('generatorGenre').value;
            const finalGenre = selectedGenre === 'Other' ? document.getElementById('customGenre').value : selectedGenre;

            const characterData = {
                playerName: document.getElementById('playerName').value,
                name: document.getElementById('name').value,
                race: document.getElementById('race').value,
                height: document.getElementById('height').value,
                weight: document.getElementById('weight').value,
                genre: finalGenre,
                imageUrl: document.getElementById('characterImage').dataset.url || '',
                stats: {
                    physicality: parseInt(document.getElementById('physicality').value) || 5,
                    agility: parseInt(document.getElementById('agility').value) || 5,
                    intuition: parseInt(document.getElementById('intuition').value) || 5,
                    charisma: parseInt(document.getElementById('charisma').value) || 5,
                },
                skills: window.skills, 
                currencies: window.currencies, 
                inventory: window.inventory,
                backstory: document.getElementById('backstoryOutput').value,
                lastUpdated: Date.now()
            };
            try {
                await setDoc(docRef, characterData);
                window.showMessage('Character saved!');
            } catch (e) { console.error(e); }
        };

        window.showMessage = (msg) => {
            const el = document.getElementById('statusMessage');
            el.textContent = msg;
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 3000);
        };

        window.setupDataListener = () => {
            const docRef = getCharacterDocRef();
            if (!docRef) return;
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) window.loadCharacter(docSnap.data());
            }, (err) => console.error(err));
        };

        const fetchWithRetry = async (url, payload, maxRetries = 5) => {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (response.ok) return response;
                } catch (error) { if (i === maxRetries - 1) throw error; }
                await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
            }
        };

        window.calculateMovement = () => {
            const agility = parseInt(document.getElementById('agility').value) || 1;
            const physicality = parseInt(document.getElementById('physicality').value) || 1;
            const movementRank = Math.max(1, Math.min(10, Math.round((agility + physicality) / 2)));
            
            const table = {
                1: { walk: ".5 ft/s", jog: "1.5 ft/s", run: "3 ft/s", desc: "Infirm" },
                2: { walk: "2.5 ft/s", jog: "6 ft/s", run: "10 ft/s", desc: "Limited" },
                3: { walk: "5 ft/s", jog: "12.5 ft/s", run: "25 ft/s", desc: "Average" },
                4: { walk: "6 ft/s", jog: "15 ft/s", run: "30 ft/s", desc: "Fit" },
                5: { walk: "6 ft/s", jog: "18 ft/s", run: "36 ft/s", desc: "Athletic" },
                6: { walk: "6.5 ft/s", jog: "22 ft/s", run: "41 ft/s", desc: "Elite" },
                7: { walk: "7 ft/s", jog: "29 ft/s", run: "50 ft/s", desc: "Olympic" },
                8: { walk: "10 ft/s", jog: "36 ft/s", run: "75 ft/s", desc: "Peak Human" },
                9: { walk: "14 ft/s", jog: "48 ft/s", run: "110 ft/s", desc: "Superhuman" },
                10: { walk: "20 ft/s", jog: "65 ft/s", run: "160 ft/s", desc: "Legendary" }
            };

            const data = table[movementRank] || table[1];
            document.getElementById('walkSpeed').textContent = data.walk;
            document.getElementById('jogSpeed').textContent = data.jog;
            document.getElementById('runSpeed').textContent = data.run;
            document.getElementById('movementDesc').textContent = `Rank ${movementRank}: ${data.desc}`;
        };

        window.chaosForge = async () => {
            const btn = document.getElementById('chaosForgeBtn');
            const prompt = document.getElementById('generatorConcept').value || "A unique and interesting character";
            const currentGenre = document.getElementById('generatorGenre').value;
            const genreStr = currentGenre === 'Other' ? document.getElementById('customGenre').value : currentGenre;

            btn.disabled = true; btn.textContent = 'FORGING...';
            
            const systemPrompt = `You are a character generator for an RPG. 
            CORE STAT SCALE (1-10):
            - 1: Severely disabled/Incapped
            - 5: Average Human
            - 8: Exceptional (equivalent to a 18/20 in other systems)
            - 10: Legendary/Transcendent
            
            STRICT RULES:
            - Stats (Physicality, Agility, Intuition, Charisma) MUST stay between 1 and 10.
            - Most characters should hover around 4-6. Only use 8+ if the concept specifically demands world-class excellence.
            - Ensure the label "Physicality" is used for the physical stat.
            
            Output ONLY valid JSON:
            {
              "name": string,
              "race": string,
              "height": string,
              "weight": string,
              "genre": string,
              "stats": { "physicality": 1-10, "agility": 1-10, "intuition": 1-10, "charisma": 1-10 },
              "skills": [{ "name": string, "level": 1-10, "description": string }],
              "backstory": string,
              "inventory": [{ "name": string, "quantity": number }],
              "currencies": [{ "name": string, "amount": number }]
            }`;

            try {
                const response = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/${TEXT_MODEL}:generateContent?key=${GEMINI_API_KEY}`, {
                    contents: [{ parts: [{ text: `Generate a character for genre: ${genreStr}. Concept: ${prompt}` }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: { responseMimeType: "application/json" }
                });
                const result = await response.json();
                const data = JSON.parse(result.candidates[0].content.parts[0].text);
                
                window.loadCharacter(data);
                window.showMessage('Character Forged Successfully!');
            } catch (e) { 
                console.error(e); 
                window.showMessage('Forge Failed. Try again.');
            } finally { 
                btn.disabled = false; btn.textContent = 'CHAOS FORGE (Random All)'; 
            }
        };

        window.suggestSkills = async () => {
            const btn = document.getElementById('suggestSkillsBtn');
            btn.disabled = true; btn.textContent = 'Thinking...';
            const genre = document.getElementById('generatorGenre').value === 'Other' ? document.getElementById('customGenre').value : document.getElementById('generatorGenre').value;
            const concept = document.getElementById('generatorConcept').value;
            const prompt = `Suggest skills for a ${genre} character named ${document.getElementById('name').value} (Concept: ${concept}).
            Scale is 1-10. 5 is average proficiency. 8 is world-class.
            Format as JSON array: [{"name": string, "level": 1-10, "description": string}].`;

            try {
                const response = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/${TEXT_MODEL}:generateContent?key=${GEMINI_API_KEY}`, {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { responseMimeType: "application/json" }
                });
                const result = await response.json();
                const newSkills = JSON.parse(result.candidates[0].content.parts[0].text);
                window.skills = [...window.skills, ...newSkills];
                window.renderSkills();
            } catch (e) { console.error(e); }
            finally { btn.disabled = false; btn.textContent = 'AI Suggest Skills'; }
        };

        window.generateBackstory = async () => {
            const btn = document.getElementById('genBackstoryBtn');
            const genre = document.getElementById('generatorGenre').value === 'Other' ? document.getElementById('customGenre').value : document.getElementById('generatorGenre').value;
            const concept = document.getElementById('generatorConcept').value;
            btn.disabled = true; btn.textContent = 'Writing...';
            try {
                const response = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/${TEXT_MODEL}:generateContent?key=${GEMINI_API_KEY}`, {
                    contents: [{ parts: [{ text: `Write an engaging backstory for ${document.getElementById('name').value}, a ${genre} character. Concept: ${concept}.` }] }]
                });
                const result = await response.json();
                document.getElementById('backstoryOutput').value = result.candidates[0].content.parts[0].text;
            } catch (e) { console.error(e); }
            finally { btn.disabled = false; btn.textContent = 'AI Rewrite Backstory'; }
        };

        window.generateImage = async () => {
            const btn = document.getElementById('generateImageButton');
            btn.disabled = true; btn.textContent = 'Generating...';
            const genre = document.getElementById('generatorGenre').value === 'Other' ? document.getElementById('customGenre').value : document.getElementById('generatorGenre').value;
            const fullPrompt = `Portrait of ${document.getElementById('name').value}, ${genre} setting. ${document.getElementById('imagePrompt').value}. Cinematic lighting.`;
            try {
                const response = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/${IMAGE_MODEL}:predict?key=${GEMINI_API_KEY}`, { instances: { prompt: fullPrompt }, parameters: { sampleCount: 1 } });
                const result = await response.json();
                const b64 = result.predictions?.[0]?.bytesBase64Encoded;
                if (b64) {
                    const url = `data:image/png;base64,${b64}`;
                    document.getElementById('characterImage').src = url;
                    document.getElementById('characterImage').dataset.url = url;
                }
            } catch (e) { console.error(e); }
            finally { btn.disabled = false; btn.textContent = 'Update Portrait'; }
        };

        window.addSkill = (s = {name:'',level:5,description:''}) => { window.skills.push(s); window.renderSkills(); };
        window.renderSkills = () => {
            const container = document.getElementById('skillContainer'); container.innerHTML = '';
            window.skills.forEach((s, i) => {
                const el = document.createElement('div');
                el.className = 'grid grid-cols-12 gap-2 mb-2 p-2 border border-slate-600 rounded bg-slate-700 items-center';
                el.innerHTML = `
                    <input type="text" value="${s.name}" onchange="window.skills[${i}].name=this.value" class="col-span-5 bg-slate-900 p-1 text-sm border-0">
                    <input type="number" value="${s.level}" onchange="window.skills[${i}].level=this.value" class="col-span-2 bg-slate-900 p-1 text-sm text-center border-0">
                    <input type="text" value="${s.description}" onchange="window.skills[${i}].description=this.value" class="col-span-4 bg-slate-900 p-1 text-sm border-0">
                    <button onclick="window.skills.splice(${i},1);window.renderSkills()" class="col-span-1 text-red-400 font-bold hover:text-red-300">×</button>`;
                container.appendChild(el);
            });
        };

        window.addCurrency = () => { window.currencies.push({name:'',amount:0}); window.renderCurrencies(); };
        window.renderCurrencies = () => {
            const container = document.getElementById('currencyContainer'); container.innerHTML = '';
            window.currencies.forEach((c, i) => {
                const el = document.createElement('div'); el.className = 'flex gap-2 mb-2';
                el.innerHTML = `<input type="text" value="${c.name}" onchange="window.currencies[${i}].name=this.value" class="flex-grow bg-slate-900 p-1"><input type="number" value="${c.amount}" onchange="window.currencies[${i}].amount=this.value" class="w-20 bg-slate-900 p-1"><button onclick="window.currencies.splice(${i},1);window.renderCurrencies()">×</button>`;
                container.appendChild(el);
            });
        };

        window.addInventory = () => { window.inventory.push({name:'',quantity:1}); window.renderInventory(); };
        window.renderInventory = () => {
            const container = document.getElementById('inventoryContainer'); container.innerHTML = '';
            window.inventory.forEach((item, i) => {
                const el = document.createElement('div'); el.className = 'flex gap-2 mb-2';
                el.innerHTML = `<input type="text" value="${item.name}" onchange="window.inventory[${i}].name=this.value" class="flex-grow bg-slate-900 p-1"><input type="number" value="${item.quantity}" onchange="window.inventory[${i}].quantity=this.value" class="w-16 bg-slate-900 p-1"><button onclick="window.inventory.splice(${i},1);window.renderInventory()">×</button>`;
                container.appendChild(el);
            });
        };

        window.handleGenreChange = () => {
            const select = document.getElementById('generatorGenre');
            const custom = document.getElementById('customGenreContainer');
            if (select.value === 'Other') custom.classList.remove('hidden');
            else custom.classList.add('hidden');
        };

        window.addEventListener('input', (e) => { if(['agility','physicality'].includes(e.target.id)) window.calculateMovement(); });
        window.addEventListener('load', window.initFirebase);
    </script>
    <style>
        body { background: #0f172a; color: #f1f5f9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { background: #1e293b; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.4); border: 1px solid #334155; }
        input, select, textarea { background: #0f172a; border: 1px solid #334155; border-radius: 0.375rem; color: white; padding: 0.5rem; transition: border-color 0.2s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #f97316; }
        .stat-box { background: #334155; border-radius: 0.5rem; text-align: center; padding: 1rem; border: 1px solid #475569; position: relative; }
        .stat-box::after { content: ''; position: absolute; inset: 0; border-radius: 0.5rem; border: 2px solid transparent; transition: 0.2s; }
        .stat-box:focus-within::after { border-color: #f97316; }
        .forge-btn { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); transition: all 0.2s; }
        .forge-btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .forge-btn:active { transform: translateY(1px); }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto space-y-6">
        <header class="text-center space-y-2">
             <img src="images/EternalForge_Logo_APP.png" alt="Eternal Forge TTRPG Logo" width="50%" style="display: block; margin: 0 auto;">
            <div id="userIdDisplay" class="text-[10px] text-slate-500 font-mono tracking-[0.2em] uppercase">STANDALONE MODE</div>
        </header>

        <!-- Generation Toolset -->
        <section class="card bg-slate-900/80 border-orange-500 grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
            <div>
                <label class="text-[10px] font-black text-orange-400 uppercase tracking-widest">Genre Selection</label>
                <select id="generatorGenre" onchange="window.handleGenreChange()" class="w-full mt-1">
                    <option>Fantasy</option><option>Sci-Fi</option><option>Modern</option><option>Cyberpunk</option><option>Steampunk</option><option>Other</option>
                </select>
                <div id="customGenreContainer" class="hidden mt-2">
                    <input type="text" id="customGenre" placeholder="Enter custom genre..." class="w-full text-xs">
                </div>
            </div>
            <div class="md:col-span-2">
                <label class="text-[10px] font-black text-orange-400 uppercase tracking-widest">Chaos Prompt / Concept</label>
                <input type="text" id="generatorConcept" placeholder="e.g. A weary clockwork knight or 'Surprise me!'" class="w-full mt-1">
            </div>
            <div class="flex gap-2">
                <button onclick="window.chaosForge()" id="chaosForgeBtn" class="forge-btn w-full font-black py-2 rounded-lg text-white shadow-lg text-xs tracking-tighter uppercase">CHAOS FORGE (Random All)</button>
                <button onclick="window.saveCharacter()" id="saveButton" class="bg-slate-700 hover:bg-slate-600 w-1/3 py-2 rounded-lg border border-slate-500 transition-colors">
                    <svg class="w-5 h-5 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>
                </button>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <aside class="space-y-6">
                <!-- Identity Card -->
                <div class="card space-y-4 border-l-4 border-slate-500">
                    <h2 class="text-lg font-bold border-b border-slate-700 pb-2 flex items-center gap-2 uppercase tracking-wide">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>
                        Identity
                    </h2>
                    <div class="space-y-3">
                        <div><label class="text-[10px] text-slate-400 uppercase font-bold">Player Name</label><input type="text" id="playerName" class="w-full mt-1"></div>
                        <div><label class="text-[10px] text-slate-400 uppercase font-bold">Char Name</label><input type="text" id="name" class="w-full mt-1"></div>
                        <div><label class="text-[10px] text-slate-400 uppercase font-bold">Race / Origin</label><input type="text" id="race" class="w-full mt-1"></div>
                        <div class="grid grid-cols-2 gap-2">
                            <div><label class="text-[10px] text-slate-400 uppercase font-bold">Height</label><input type="text" id="height" class="w-full mt-1"></div>
                            <div><label class="text-[10px] text-slate-400 uppercase font-bold">Weight</label><input type="text" id="weight" class="w-full mt-1"></div>
                        </div>
                    </div>
                </div>

                <!-- Portrait Card -->
                <div class="card bg-slate-800 border-orange-900">
                    <div class="relative group overflow-hidden rounded-lg">
                        <img id="characterImage" src="https://placehold.co/150x200/222/444?text=Portrait" class="w-full h-64 object-cover shadow-inner transition-transform group-hover:scale-105">
                    </div>
                    <label class="text-[10px] text-slate-400 uppercase font-bold mt-4 block">Visual descriptor for AI</label>
                    <input type="text" id="imagePrompt" placeholder="Goggles, mechanical arm..." class="w-full text-xs mb-3">
                    <button onclick="window.generateImage()" id="generateImageButton" class="w-full bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white font-bold py-2 rounded-lg text-xs transition-colors uppercase">Update Portrait</button>
                </div>
            </aside>

            <main class="lg:col-span-2 space-y-6">
                <!-- Stats & Tactical -->
                <div class="card border-l-4 border-orange-600">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2 uppercase tracking-wide">
                        <svg class="w-6 h-6 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>
                        Basic Core Stats (1-10)
                    </h2>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
                        <div class="stat-box"><label class="text-[10px] block mb-1 text-slate-400">PHYSICALITY</label><input type="number" id="physicality" value="5" min="1" max="10" class="w-full bg-transparent text-center text-2xl font-black text-orange-500"></div>
                        <div class="stat-box"><label class="text-[10px] block mb-1 text-slate-400">AGILITY</label><input type="number" id="agility" value="5" min="1" max="10" class="w-full bg-transparent text-center text-2xl font-black text-orange-500"></div>
                        <div class="stat-box"><label class="text-[10px] block mb-1 text-slate-400">INTUITION</label><input type="number" id="intuition" value="5" min="1" max="10" class="w-full bg-transparent text-center text-2xl font-black text-slate-100"></div>
                        <div class="stat-box"><label class="text-[10px] block mb-1 text-slate-400">CHARISMA</label><input type="number" id="charisma" value="5" min="1" max="10" class="w-full bg-transparent text-center text-2xl font-black text-slate-100"></div>
                    </div>

                    <div class="bg-slate-900 p-4 rounded-xl border border-slate-700">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Tactical Movement Engine</h3>
                            <span id="movementDesc" class="text-[10px] bg-orange-900/40 text-orange-400 px-2 py-0.5 rounded border border-orange-500/20">Rank 5: Athletic</span>
                        </div>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="bg-slate-800 p-3 rounded-lg text-center border border-slate-700">
                                <div class="text-[10px] text-slate-500 mb-1 uppercase">Walk</div>
                                <div id="walkSpeed" class="text-lg font-bold">6 ft/s</div>
                            </div>
                            <div class="bg-slate-800 p-3 rounded-lg text-center border border-slate-700 ring-1 ring-orange-500/30">
                                <div class="text-[10px] text-slate-500 mb-1 uppercase">Jog</div>
                                <div id="jogSpeed" class="text-lg font-bold text-orange-400">18 ft/s</div>
                            </div>
                            <div class="bg-slate-800 p-3 rounded-lg text-center border border-slate-700">
                                <div class="text-[10px] text-slate-500 mb-1 uppercase">Run</div>
                                <div id="runSpeed" class="text-lg font-bold text-red-500">36 ft/s</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Skills -->
                <div class="card">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold flex items-center gap-2 uppercase tracking-wide">
                            <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>
                            Skills
                        </h2>
                        <button onclick="window.suggestSkills()" id="suggestSkillsBtn" class="text-[10px] bg-blue-900/40 hover:bg-blue-800/60 text-blue-400 border border-blue-500/30 px-3 py-1 rounded-full font-bold transition-all uppercase">AI Suggest Skills</button>
                    </div>
                    <div id="skillContainer" class="min-h-[100px]"></div>
                    <button onclick="window.addSkill()" class="w-full mt-4 text-[10px] font-bold text-slate-500 hover:text-white uppercase tracking-tighter transition-colors">+ Manual Skill Row</button>
                </div>

                <!-- Backstory -->
                <div class="card border-t-2 border-orange-500/20">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold flex items-center gap-2 uppercase tracking-wide">
                            <svg class="w-6 h-6 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>
                            Biography
                        </h2>
                        <button onclick="window.generateBackstory()" id="genBackstoryBtn" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-1.5 rounded-lg text-xs font-bold shadow-lg uppercase">AI Rewrite Story</button>
                    </div>
                    <textarea id="backstoryOutput" rows="6" placeholder="A mysterious past awaits..." class="w-full text-sm bg-slate-900 border-slate-700 rounded-lg p-4 leading-relaxed italic"></textarea>
                </div>
            </main>
        </div>

        <!-- Inventory Footer -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-12">
            <div class="card">
                <h2 class="text-lg font-bold mb-4 flex justify-between items-center uppercase tracking-wide">
                    <div class="flex items-center gap-2">
                        <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>
                        Wealth Assets
                    </div>
                    <button onclick="window.addCurrency()" class="w-6 h-6 bg-slate-700 rounded flex items-center justify-center text-xs hover:bg-slate-600">+</button>
                </h2>
                <div id="currencyContainer" class="space-y-2"></div>
            </div>
            <div class="card">
                <h2 class="text-lg font-bold mb-4 flex justify-between items-center uppercase tracking-wide">
                    <div class="flex items-center gap-2">
                        <svg class="w-5 h-5 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>
                        Inventory
                    </div>
                    <button onclick="window.addInventory()" class="w-6 h-6 bg-slate-700 rounded flex items-center justify-center text-xs hover:bg-slate-600">+</button>
                </h2>
                <div id="inventoryContainer" class="space-y-2"></div>
            </div>
        </div>

        <div id="statusMessage" class="hidden fixed bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 bg-orange-600 text-white rounded-full text-sm font-bold shadow-2xl"></div>
    </div>
</body>
</html>